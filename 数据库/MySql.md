# MySql 

存储引擎：Innodb和myisam（都是B+树）

| Innodb                       | myisam                           |
| ---------------------------- | -------------------------------- |
| 聚簇索引（叶子结点就是数据） | 非聚簇索引（叶子结点是数据地址） |
| 支持事务                     | 不支持事务                       |
| 支持外键                     | 不支持外键                       |
| 支持行级锁                   | 支持表级锁                       |
| 支持MVCC                     | 不支持MVCC                       |

事务：一条SQL语句，一组SQL语句或整个程序。是恢复和[并发控制](https://baike.baidu.com/item/并发控制)的基本单位。

事务的ACID属性：原子性，一致性，隔离性，持续性

原子：每个事务不可分割，要么做，要么不做

一致性：事务是使数据库从一个一致性状态变到另一个一致性

持续性：事务一旦提交，对数据库修改是永久性的

隔离性：事务之间不能互相干扰 

## 四个隔离级别

未提交读：RU（脏读+不可重复读+幻读），数据有写锁，无读锁

已提交读：RC（不可重复读+幻读），每个数据加入排他锁和共享锁，不能共存，但可有多个共享锁，并读完就释放

可重复读：RR，MySql默认级别（幻读），共享锁修改，事务准备提交才释放

可串行化：S（无），事务只能一件件完成

附：

脏读：A事务运行一个查询，B事务在查询前修改，查询后回滚，B事务完成，此时数据错误

不可重复读：A事务运行两次查询，B事务在查询中修改，A第一次查询错误

幻读：A事务修改某行后查询，B事务中途插入同一数据，A事务看起来像没有修改

## explain优化

信息很多，主要看type

system(一行)>const(一次索引)>eq_ref(唯一索引扫描)>ref(非唯一索引扫描)>range(特定行)>index(索引树)>all(全表)

执行顺序：
from->on->join->where->group by->having->select->distinct->order by->limit
简记：先构造虚拟表，然后select，再对表处理

