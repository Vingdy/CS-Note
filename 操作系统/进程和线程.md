# 进程和线程

进程是执行着的应用程序，是操作系统资源分配和调度的**独立**单位，而线程是进程内部的一个执行序列，是任务调度和执行的**基本**单位 

### 联系

 线程属于某一个进程，一个进程可以拥有多个线程，一个线程必须属于一个进程，同时线程会共享对应进程的资源，因为有线程的原因，使得进程能够并发，提高系统吞吐量。 某进程内的线程在其它进程不可见。 

### 区别

进程之间相互独立，各自拥有自己的资源和内存空间，但线程之间是会共享对应进程的资源和内存空间，但也有自己的资源（例如自己有自己的栈）；

进程之间切换开销会比较大，而线程切换的开销会比较小。

### 面试被问

##### 线程被称为轻量化进程的原因

因为同一个进程中的线程共享这个进程的资源，但是每个线程都有自己的栈和程序计数器PC，同时创建一个线程代价小，线程之间的切换比较小。

##### 线程有内核态和用户态，怎么切换

线程在程序中或者一般情况下都是用户态，某些情况下才会进入内核态，对于进程也是类似

用户态切换到内核态的3种方式

①系统调用：调用系统调用函数产生中断，用户可以产生

②异常：运用程序时发生不可知异常，如缺页中断等

③设备的中断：读写操作或者硬件操作导致的中断，例如硬盘读写操作完成

##### 一个进程是不是可以创建无限数量的线程？线程的数量会受到什么限制？在内存中会占用什么资源？

不是；受到进程的空间以及线程栈创建空间的限制，同时也受到内存限制；线程拥有自己的私有内存， 例如本地方法的线程栈以及程序计数器寄存器

##### 线程栈是在哪里分配

一般默认情况下，线程栈是在进程的堆中分配栈空间，每个线程拥有独立的栈空间，为了避免线程之间的栈空间踩踏 

## 进程通信方法的特点以及使用场景

①管道 

管道是进程间通信中最古老的方式，包括无名管道和有名管道两种，前者用于父进程和子进程间的通信，后者用于运行于同一台机器上的任意两个进程间的通信

②消息队列 

消息队列用于运行于同一台机器上的进程间通信，它和管道很相似，是一个在系统内核中用来保存消息的队列，它在系统内核中是以消息链表的形式出现。消息链表中节点的结构用msg声明。事实上，它是一种正逐渐被淘汰的通信方式，我们可以用流管道或者套接口的方式来取代它。 

③ 共享内存 

共享内存是运行在同一台机器上的进程间通信最快的方式，因为数据不需要在不同的进程间复制。通常由一个进程创建一块共享内存区，其余进程对这块内存区进行 读写。得到共享内存有两种方式：映射/dev/mem设备和内存映像文件。前一种方式不给系统带来额外的开销，但在现实中并不常用，因为它控制存取的将是实际的物理内存。

④信号量 

信号量是用来协调不同进程间的数据对象的，而最主要的应用是前一节的共享内存方式的进程间通信。本质上，信号量是一个计数器，它用来记录对某个资源（如共享内存）的存取状况。（原理就是同步互斥问题）

⑤套接口 

套接口（socket）编程是实现Linux系统和其他大多数操作系统中进程间通信的主要方式之一。WWW服务、FTP服务、TELNET服务等都是基于套接口编程来实现的。无论是异地的计算机进程间还是本地同一台计算机内部的进程间通信都适用。

## 线程间通信方式

①锁机制：包括互斥锁、条件变量、读写锁

互斥锁提供了以排他方式防止数据结构被并发修改的方法。 
读写锁允许多个线程同时读共享数据，而对写操作是互斥的。 
条件变量可以以原子的方式阻塞进程，直到某个特定条件为真为止。对条件的测试是在互斥锁的保护下进行的。条件变量始终与互斥锁一起使用。

wait/notify 等待

Volatile 内存共享

CountDownLatch 并发工具

CyclicBarrier 并发工具

②信号量机制(Semaphore)

包括无名线程信号量和命名线程信号量。

③信号机制(Signal)

类似进程间的信号处理。

线程间的通信目的主要是用于线程同步，所以线程没有像进程通信中的用于数据交换的通信机制。

## 僵尸进程

当子进程先于父进程退出时，父进程没有调用wait函数或者waitpid()函数等待子进程结束，又没有显式忽略SIGCHLD信号，或者子进程调用exit函数的时候，这时候子进程虽然是结束了，但是其PCB会留下并同时占用进程号

## 孤儿进程

当父进程先于子进程退出时，留下仍然在运行的子进程就是孤儿进程，最后会被init进程接收并处理

## 守护进程

在后台运行，没有控制终端与之相连的进程；它独立于控制终端，通常周期性地执行某种任务 。

守护进程脱离于终端是为了避免进程在执行过程中的信息在任何终端上显示并且进程也不会被任何终端所产生的终端信息所打断 。 



